{
    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "location": {
			"defaultValue": "[resourceGroup().location]",
            "type": "String"
        },
        "loadBalancersName": { 
			"defaultValue": "lbname",
            "type": "String"
        },
        "alteonsAzureFuncName": { 
			"defaultValue": "func",
            "type": "String"
        },
        "alteonsAzureFuncServerFarmId": { 
			"defaultValue": "serverfarm",
            "type": "String"
        },
        "alteonAzureFuncServerfarmsPlanName": { 
			"defaultValue": "serverfarmplan",
            "type": "String"
        },
        "storageAccountNameRef": { 
			"defaultValue": "storageaccountname",
            "type": "String"
        },
        "blobContainerName": { 
			"defaultValue": "blobcontainername",
            "type": "String"
        },
        "alteonAzureFuncHostNameBindingsName": { 
			"defaultValue": "hostbindingname",
            "type": "String"
        }                                      
    }, 
    "resources": [    
        {
        "type": "Microsoft.Web/sites",
        "kind": "functionapp",
        "name": "[parameters('alteonsAzureFuncName')]",
        "apiVersion": "2016-08-01",
        "location": "[parameters('location')]",
        "scale": null,
        "properties": {

            "serverFarmId": "[parameters('alteonsAzureFuncServerFarmId')]",
            "reserved": false,
            "siteConfig": null,
            "scmSiteAlsoStopped": false,
            "hostingEnvironmentProfile": null,
            "clientAffinityEnabled": false,
            "clientCertEnabled": false,
            "hostNamesDisabled": false,
            "containerSize": 1536,
            "dailyMemoryTimeQuota": 0,
            "cloningInfo": null
        },
        "dependsOn": [
            "[resourceId('Microsoft.Web/serverfarms', parameters('alteonAzureFuncServerfarmsPlanName'))]"
        ],
        "resources": [
            {
                "apiVersion": "2018-02-01",
                "name": "appsettings",
                "type": "config",
                "dependsOn": [
                    "[resourceId('Microsoft.Web/sites', parameters('alteonsAzureFuncName'))]",
                    "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountNameRef'))]"
                ],
                "properties": {
                    "AzureWebJobsStorage": "[concat('DefaultEndpointsProtocol=https;AccountName=',parameters('storageAccountNameRef'),';AccountKey=',listkeys(resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountNameRef')), '2018-02-01').keys[0].value)]", 
                    "AzureWebJobsDashboardWEBSITE_CONTENTAZUREFILECONNECTIONSTRING": "[concat('DefaultEndpointsProtocol=https;AccountName=',parameters('storageAccountNameRef'),';AccountKey=',listkeys(resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountNameRef')), '2018-02-01').keys[0].value)]", 
                    "FUNCTIONS_EXTENSION_VERSION": "~2",
                    "AzureWebJobsSecretStorageType": "Files"
                }
            },
            {        
                "apiVersion": "2018-02-01",
                "name": "TestFunctionCM",
                "type": "functions",
                "dependsOn": [
                    "[resourceId('Microsoft.Web/sites', parameters('alteonsAzureFuncName'))]"
                ],
                "properties": {
                    "config": {
                        "bindings": [
                            {
                                "authLevel": "anonymous",
                                "name": "req",
                                "type": "httpTrigger",
                                "direction": "in"
                            },
                            {
                                "name": "res",
                                "type": "http",
                                "direction": "out"
                            },
                            {
                                "name": "blob",
                                "type": "blob",
                                "direction": "in",
                                "path": "[concat(parameters('blobContainerName'), '/clusterConfiguration.tgz')]",
                                "connection": "AzureWebJobsStorage"
                        }
                    ]
                },
                "files": {}
                    
            }
            }
        
        ]
    },
    {
        "type": "Microsoft.Web/sites/hostNameBindings",
        "name": "[concat(parameters('alteonsAzureFuncName'), '/', parameters('alteonAzureFuncHostNameBindingsName'))]",
        "apiVersion": "2018-02-01",
        "location": "[parameters('location')]",
        "scale": null,
        "properties": {
            "siteName": "[parameters('alteonsAzureFuncName')]",
            "domainId": null,
            "hostNameType": "Verified"
        },
        "dependsOn": [
            "[resourceId('Microsoft.Web/sites', parameters('alteonsAzureFuncName'))]"
        ]
    }    
],
"outputs": {
    "alteonsAzureFuncName": {
        "type": "String",
        "value": "Hello world"
    }
}
}