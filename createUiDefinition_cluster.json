{  
    "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
	"handler":"Microsoft.Compute.MultiVm",
    "version":"0.1.2-preview",
    "parameters":{  
        "basics":[  
            {  
                "name":"AlteonClusterName",
                "type":"Microsoft.Common.TextBox",
                "label":"Alteon Cluster Name",
                "defaultValue":"[concat('alteon-cluster', string(rand(1, 1000)))]",
                "constraints":{  
                    "regex":"^([a-z0-9A-Z]*[-]{1}[a-z0-9A-Z]{1,}$)",
                    "validationMessage":"Alteon cluster must start with an alphanumeric characters"
                },
                "toolTip":"Alteon VA Cluster name",
                "visible":true
            } 
        ],
        "steps":[         
            {  
                "name":"VmssInstanceCredentials",
                "label":"VMSS Instance Credentials",
                "subLabel":{  
                    "preValidation":"Configure VMSS instance credentials settings",
                    "postValidation":"Done"
                },
                "bladeTitle":" VMSS instance credentials settings",
                "elements":[  
                    {  
                        "name":"EnaDisVmssInstanceCredentials",
                        "type":"Microsoft.Common.OptionsGroup",
                        "label":"Enable/Disable Alteon use of VMSS instance credentias",
                        "defaultValue":"Disable",
                        "toolTip":"Enable/Disable Alteon use of VMSS instance credentias",
                        "constraints":{  
                            "allowedValues":[  
                                {  
                                    "label":"Enable",
                                    "value":"Enable"
                                },
                                {  
                                    "label":"Disable",
                                    "value":"Disable"
                                }
                            ]
                        },
                        "visible":true
                    },
                    {  
                        "name":"adminUsername",
                        "type":"Microsoft.Compute.UserNameTextBox",
                        "label":"Username",
                        "toolTip":"Administrator user name for the Alteon virtual VA machine",
                        "osPlatform":"Linux",
                        "visible":"[equals(steps('VmssInstanceCredentials').EnaDisVmssInstanceCredentials, 'Enable')]"
                    },
                    {  
                        "name":"adminPassword",
                        "type":"Microsoft.Compute.CredentialsCombo",
                        "label":{  
                            "authenticationType":"VMSS instance credentials",
                            "password":"Password",
                            "confirmPassword":"Confirm password",
                            "sshPublicKey":"SSH Public Key"
                        },
                        "toolTip":{  
                            "password":"Admin password for the virtual machines"
                        },
                        "options":{  
                            "hideConfirmation":true,
                            "hidePassword":false
                        },
                        "osPlatform":"Linux",
                        "visible":"[equals(steps('VmssInstanceCredentials').EnaDisVmssInstanceCredentials, 'Enable')]"
                    }
                ]
            },
            {  
                "name":"GelSettings",
                "label":"GEL Settings",
                "subLabel":{  
                    "preValidation":"Configure GEL settings",
                    "postValidation":"Done"
                },
                "bladeTitle":"License Server Mode",
                "elements":[  
                    {  
                        "name":"ClsLlsGelSettings",
                        "type":"Microsoft.Common.OptionsGroup",
                        "label":"Cloud/Local GEL settings",
                        "defaultValue":"Local",
                        "toolTip":"Cloud/Local GEL setting",
                        "constraints":{  
                            "allowedValues":[  
                                {  
                                    "label":"Cloud",
                                    "value":"Cloud"
                                },
                                {  
                                    "label":"Local",
                                    "value":"Local"
                                }
                            ]
                        },
                        "visible":true
                    },
                    {  
                        "name":"cloudLicenseServerId",
                        "type":"Microsoft.Common.TextBox",
                        "label":"Cloud License Server ID",
                        "defaultValue": "",
                        "toolTip":"Cloud license server ID",
                        "constraints":{  
                            "required":true
                        },                      
                        "visible":"[equals(steps('GelSettings').ClsLlsGelSettings, 'Cloud')]"
                    },
                    {
                        "name":"PrimaryDnsIP",
                        "type":"Microsoft.Common.TextBox",
                        "label":"Primary DNS IP Address",
                        "defaultValue":"",
                        "toolTip":"Primary DNS IP Address",
                        "constraints":{  
                            "required":true,
                            "regex":"^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)$",
                            "validationMessage":"Format should be a valid IPv4 address"
                        },
                        "visible":"[equals(steps('GelSettings').ClsLlsGelSettings, 'Cloud')]"      
                    },            
                    {
                        "name":"SecondaryDnsIP",
                        "type":"Microsoft.Common.TextBox",
                        "label":"Secondary DNS IP Address",
                        "defaultValue":"",
                        "toolTip":"Secondary DNS IP Address",
                        "constraints":{  
                            "required":true,
                            "regex":"^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)$",
                            "validationMessage":"Format should be a valid IPv4 address"
                        },
                        "visible":"[equals(steps('GelSettings').ClsLlsGelSettings, 'Cloud')]"      
                    },                                    
                    {  
                        "name":"SecondaryLlsIP",
                        "type":"Microsoft.Common.TextBox",
                        "label":"Secondary LLS IP Address",
                        "defaultValue":"",
                        "toolTip":"Secondary LLS IP Address",
                        "constraints":{  
                            "required":true,
                            "regex":"^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)$",
                            "validationMessage":"Format should be a valid IPv4 address"
                        },
                        "visible":"[equals(steps('GelSettings').ClsLlsGelSettings, 'Local')]"     
                    },
                    {  
                        "name":"SecondaryLlsIP",
                        "type":"Microsoft.Common.TextBox",
                        "label":"Secondary LLS IP Address",
                        "defaultValue":"",
                        "toolTip":"Secondary LLS IP Address",
                        "constraints":{  
                            "required":true,
                            "regex":"^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)$",
                            "validationMessage":"Format should be a valid IPv4 address"
                        },
                        "visible":"[equals(steps('GelSettings').ClsLlsGelSettings, 'Local')]"     
                    },
                    {
                        "name":"ThroughputLicense",
                        "type":"Microsoft.Common.TextBox",
                        "label":"Throughput (MBS)",
                        "defaultValue":"",
                        "toolTip":"Throughput (MBS)",
                        "constraints":{  
                            "required":true,
                            "regex":"^\\d+$",
                            "validationMessage":"Format should be valid throughput value in MBS"                            
                        }  
                    },
                    {
                        "name":"DpsPackage",
                        "type":"Microsoft.Common.DropDown",
                        "label":"DPS Package",
                        "defaultValue":"Throughput",
                        "toolTip":"DPS Package",
                        "constraints":{ 
                            "allowedValues":[
                                {  
                                    "label":"Throughput",
                                    "value":"Throughput"
                                },     
                                {  
                                    "label":"Secure",
                                    "value":"Secure"
                                },
                                {  
                                    "label":"Perform",
                                    "value":"Perform"
                                }                                                                                           
                            ]
                        }  
                    }, 
                    {
                        "name":"AddOnSubsciption",
                        "type":"Microsoft.Common.DropDown",
                        "label":"Add-On Subsciption",
                        "defaultValue":"Sub1",
                        "toolTip":"Add-On Subsciption",
                        "constraints":{ 
                            "allowedValues":[
                                {
                                    "label":"Sub1",
                                    "value":"Sub1" 
                                }                               
                            ]                            
                        },
                        "visible":"[equals(steps('GelSettings').DpsPackage, 'Secure')]"           
                    }                                                                                                             
              ]
            },
            {  
                "name":"AdvancedLbSettings",
                "label":"Advanced LB Settings",
                "subLabel":{  
                    "preValidation":"Configure Advanced LB settings",
                    "postValidation":"Done"
                },
                "bladeTitle":"Advanced LB Settings",
                "elements":[  
                    {  
                        "name":"EnaDisLbSettings",
                        "type":"Microsoft.Common.OptionsGroup",
                        "label":"Enable/Disable Advanced LB settings",
                        "defaultValue":"Disable",
                        "toolTip":"Enable/Disable Advanced LB settings",
                        "constraints":{  
                            "allowedValues":[  
                                {  
                                    "label":"Enable",
                                    "value":"Enable"
                                },
                                {  
                                    "label":"Disable",
                                    "value":"Disable"
                                }
                            ]
                        },
                        "visible":true
                    },
                    {
                        "name":"LbType",
                        "type":"Microsoft.Common.DropDown",
                        "label":"Type",
                        "defaultValue":"Public",
                        "toolTip":"LB Type",
                        "constraints":{ 
                            "allowedValues":[
                                {
                                    "label":"Internal",
                                    "value":"Internal" 
                                },
                                {
                                    "label":"Public",
                                    "value":"Public" 
                                }                                          
                            ]                            
                        },
                        "visible":"[equals(steps('AdvancedLbSettings').EnaDisLbSettings, 'Enable')]"           
                    },
                    {
                        "name":"LbSku",
                        "type":"Microsoft.Common.DropDown",
                        "label":"SKU",
                        "defaultValue":"Standard",
                        "toolTip":"LB SKU",
                        "constraints":{ 
                            "allowedValues":[
                                {
                                    "label":"Standard",
                                    "value":"Standard" 
                                },
                                {
                                    "label":"Basic",
                                    "value":"Basic" 
                                }                                          
                            ]                            
                        },
                        "visible":"[equals(steps('AdvancedLbSettings').EnaDisLbSettings, 'Enable')]"           
                    },
                    {
                        "name":"LbPublicIpAddress",
                        "type":"Microsoft.Network.PublicIpAddressCombo",
                        "label": {
                            "publicIpAddress":"Public IP address for Alteon cluster",
                            "domainNameLabel":"Hostname name Alteon cluster"
                        },
                        "toolTip":{
                            "publicIpAddress": "Public IP address for Alteon cluster"                     
                        },
                        "defaultValue":{  
                            "publicIpAddressName":"",
                            "domainNameLabel":""
                        },
                        "options":{  
                            "hideNone":true,
                            "hideExisting":true,
                            "hideDomainNameLabel":true
                        },                                                   
                        "visible":"[equals(steps('AdvancedLbSettings').EnaDisLbSettings, 'Enable')]"           
                    }                                                                                 
                ]
            },    
            {  
                "name":"ScalesetSettings",
                "label":"Scaleset Settings",
                "subLabel":{  
                    "preValidation":"Configure Scaleset settings",
                    "postValidation":"Done"
                },
                "bladeTitle":"Advanced Scaleset Settings",
                "elements":[  
                    {  
                        "name":"EnaDisScalesetSettings",
                        "type":"Microsoft.Common.OptionsGroup",
                        "label":"Enable/Disable advanced Scaleset settings",
                        "defaultValue":"Disable",
                        "toolTip":"Enable/Disable advanced Scaleset settings",
                        "constraints":{  
                            "allowedValues":[  
                                {  
                                    "label":"Enable",
                                    "value":"Enable"
                                },
                                {  
                                    "label":"Disable",
                                    "value":"Disable"
                                }
                            ]
                        },
                        "visible":true
                    },
                    {
                        "name":"InstanceCount",
                        "type":"Microsoft.Common.TextBox",
                        "label":"Instance count",
                        "defaultValue":"2",
                        "toolTip":"Define minimum instances to be deoloyed on provisioning stage",
                        "constraints":{ 
                            "required": true,
                            "regex":"^\\d+$",
                            "validationMessage": "Only numeric characters are allowed 1-100"
                        },
                        "visible":"[equals(steps('ScalesetSettings').EnaDisScalesetSettings, 'Enable')]"           
                    },
                    {
                        "name":"InstanceSize",
                        "type":"Microsoft.Common.TextBox",
                        "label":"Instance size",
                        "defaultValue":"Standard_D1",
                        "toolTip":"Define instances VM size",
                        "constraints":{ 
                            "required": true,
                            "regex": "^[a-z0-9A-Z]{1,30}$",
                            "validationMessage": "Only alphanumeric characters are allowed"
                        },
                        "visible":"[equals(steps('ScalesetSettings').EnaDisScalesetSettings, 'Enable')]"           
                    },           
                    {
                        "name":"MinNumOfVMs",
                        "type":"Microsoft.Common.TextBox",
                        "label":"Minimum number of VMs",
                        "defaultValue":"1",
                        "toolTip":"Define minimum of scaleset VMs",
                        "constraints":{ 
                            "required": true,
                            "regex":"^\\d+$",
                            "validationMessage": "Only numeric characters are allowed 1-10"
                        },
                        "visible":"[equals(steps('ScalesetSettings').EnaDisScalesetSettings, 'Enable')]"           
                    },              
                    {
                        "name":"MaxNumOfVMs",
                        "type":"Microsoft.Common.TextBox",
                        "label":"Maximum number of VMs",
                        "defaultValue":"10",
                        "toolTip":"Define maximum of scaleset VMs",
                        "constraints":{ 
                            "required": true,
                            "regex":"^\\d+$",
                            "validationMessage": "Only numeric characters are allowed 1-10"
                        },
                        "visible":"[equals(steps('ScalesetSettings').EnaDisScalesetSettings, 'Enable')]"           
                    },
                    {
                        "name":"ScaleOut",
                        "type":"Microsoft.Common.Section",
                        "label":"Scale out",
                        "elements": [
                            {
                              "name": "ScaleOut1",
                              "type": "Microsoft.Common.TextBox",
                              "label": "CPU threshold (%)"
                            },
                            {
                              "name": "ScaleOut2",
                              "type": "Microsoft.Common.TextBox",
                              "label": "Inbound traffic (Mbps)"
                            },
                            {
                                "name": "ScaleOut3",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Number of VMS to increase by"
                              }                            
                        ],
                        "visible":"[equals(steps('ScalesetSettings').EnaDisScalesetSettings, 'Enable')]"           
                    },
                    {
                        "name":"ScaleIn",
                        "type":"Microsoft.Common.Section",
                        "label":"Scale in",
                        "elements": [
                            {
                              "name": "ScaleIn1",
                              "type": "Microsoft.Common.TextBox",
                              "label": "CPU threshold (%)"
                            },
                            {
                              "name": "ScaleIn2",
                              "type": "Microsoft.Common.TextBox",
                              "label": "Inbound traffic (Mbps)"
                            },
                            {
                                "name": "ScaleIn3",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Number of VMS to increase by"
                              }                            
                        ],
                        "visible":"[equals(steps('ScalesetSettings').EnaDisScalesetSettings, 'Enable')]"           
                    }                                                                                                                                                                       
                ]
            }                                                      
        ],
        "outputs":{  
            "location":"[location()]",
            "VMPrefixName":"[basics('AlteonClusterName')]",
            "adminUsername":"[steps('VmssInstanceCredentials').adminUsername]",
            "adminPassword":"[steps('VmssInstanceCredentials').adminPassword.password]",
            "StorageAccountName":"[steps('infrastructureConfig').storageAccount.name]",
            "vmSize":"[steps('infrastructureConfig').vmSize]",
            "vmCount":"[steps('infrastructureConfig').VmCount]",
            "dnsNameForPublicIP":"[steps('infrastructureConfig').dnsAndPublicIP.domainNameLabel]",
            "ClientID":"[steps('ActiveDirSetting').ActiveDirectoryCredentials.ClientID]",
            "ClientSecret":"[steps('ActiveDirSetting').ActiveDirectoryCredentials.ClientSecret]",
            "TenantID":"[steps('ActiveDirSetting').ActiveDirectoryCredentials.TenantID]",
            "DNSServerIP":"[steps('ActiveDirSetting').DNSServerIP]",
            "RealsCount":"[string(steps('SLBSetting').RealsCount)]",
            "SLBPortNumber":"[steps('SLBSetting').SLBPortNumber]",
            "SLBMetric":"[steps('SLBSetting').SLBMetric]"
        }
    }
}